<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="https://fonts.googleapis.com/css?family=Mulish&display=swap" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono&display=swap" rel="stylesheet" /><link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <title>Turnos disponibles</title>
</head>
<body>
    <div class="style-header">
      <div class="icono_encabezado turnos"></div>
      <span class="encabezado">Turnos disponibles</span>
    </div>
    <div class="reloj">
      <p class="tiempo"></p>
      <p class="fecha"></p>
    </div>
    <div class="new-shift-container">
      <div style="align-items: center;">
        <label for="Dias">Seleccione un día:</label>
        <select id="Dias" name="Dias" class="dropdown-spacing"></select>
        <br>
        <label for="Hora">Seleccione una hora:</label>
        <select id="Hora" name="Hora" class="dropdown-spacing"></select>
      </div>
      <button class="button-gral">Confirmar</button>
    </div>
    <script>
        $(document).ready(function() {
          // Obtener la especialidad seleccionada
          var especialidadSeleccionada = localStorage.getItem('especialidadSeleccionada');
          if (!especialidadSeleccionada) {
            alert('No se ha seleccionado ninguna especialidad.');
            location.href = '/'; // Redirigir a la página de selección si no hay especialidad
            return;
          }
    
          // Obtener los datos de los médicos y turnos
          $.when(
            $.getJSON('/data/doctor'),
            $.getJSON('/data/shifts')
          ).done(function(doctorsData, shiftsData) {
            var doctors = doctorsData[0].Doctors;
            var shifts = shiftsData[0].TurnosDisponibles;
    
            // Filtrar los médicos por especialidad
            var medicosFiltrados = doctors.filter(doc => doc.especialidad.toLowerCase() === especialidadSeleccionada.toLowerCase());
            var idsMedicosFiltrados = medicosFiltrados.map(doc => doc.idMedico);
    
            // Filtrar los turnos disponibles por los médicos de la especialidad seleccionada
            var turnosFiltrados = shifts.filter(turno => idsMedicosFiltrados.includes(turno.idMedico));
    
            var diasDisponibles = [];
            var horasDisponibles = [];
            
            turnosFiltrados.forEach(function(turno) {
              if (!diasDisponibles.includes(turno.fechaTurno)) {
                diasDisponibles.push(turno.fechaTurno);
              }
              if (!horasDisponibles.includes(turno.hora)) {
                horasDisponibles.push(turno.hora);
              }
            });
    
            // Poblar el select de días
            var selectDias = $('#Dias');
            diasDisponibles.forEach(function(dia) {
              selectDias.append($('<option>', { value: dia, text: dia }));
            });
    
            // Poblar el select de horas
            var selectHoras = $('#Hora');
            horasDisponibles.forEach(function(hora) {
              selectHoras.append($('<option>', { value: hora, text: hora }));
            });
          }).fail(function(jqxhr, textStatus, error) {
            var err = textStatus + ", " + error;
            console.log("Request Failed: " + err);
          });
        });
      </script>
  </body>
<script src="/scripts/reloj.js"></script>

</html>